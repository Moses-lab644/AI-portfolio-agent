<!DOCTYPE html>

<html class="dark" lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>AI Portfolio Agent Dashboard</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#6A3FFF",
                        "background-light": "#f5f6f8",
                        "background-dark": "#111116",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.25rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
<style type="text/tailwindcss">
        .material-symbols-outlined {
            font-variation-settings:
            'FILL' 0,
            'wght' 400,
            'GRAD' 0,
            'opsz' 24
        }
    </style>
</head>
<body class="bg-background-dark font-display text-gray-200">
<div class="relative flex h-auto min-h-screen w-full flex-col">
<div class="layout-container flex h-full grow flex-col">
<!-- TopNavBar -->
<header class="border-b border-solid border-white/10 px-4 sm:px-6 lg:px-10">
<div class="mx-auto flex max-w-7xl items-center justify-between whitespace-nowrap py-4">
<div class="flex items-center gap-4 text-white">
<div class="size-6 text-primary">
<svg fill="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM10 8h4v8h-4z"></path>
<path d="M12 14.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5-1.5-.67-1.5-1.5.67-1.5 1.5-1.5zm0-9c.83 0 1.5.67 1.5 1.5S12.83 8.5 12 8.5s-1.5-.67-1.5-1.5S11.17 5.5 12 5.5z"></path>
</svg>
</div>
<h2 class="text-white text-lg font-bold leading-tight tracking-[-0.015em]">AetherAgent</h2>
<div class="flex items-center gap-2 ml-4">
<div class="relative">
<button onclick="toggleProfileDropdown()" class="flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-300 hover:text-white hover:bg-white/10 rounded-lg transition-colors">
<span class="material-symbols-outlined text-base">person</span>
Profile
<span class="material-symbols-outlined text-base transition-transform" id="profileArrow">expand_more</span>
</button>
<div id="profileDropdown" class="absolute top-full left-0 mt-2 w-48 bg-[#1C1C24] border border-white/10 rounded-lg shadow-lg hidden z-50">
<div class="py-2">
<button onclick="openProfileModal(); closeProfileDropdown()" class="w-full text-left px-4 py-2 text-sm text-gray-300 hover:text-white hover:bg-white/10 transition-colors">
<span class="material-symbols-outlined text-base mr-2">edit</span>
Edit Profile
</button>
<button onclick="viewProfile(); closeProfileDropdown()" class="w-full text-left px-4 py-2 text-sm text-gray-300 hover:text-white hover:bg-white/10 transition-colors">
<span class="material-symbols-outlined text-base mr-2">visibility</span>
View Profile
</button>
<hr class="border-white/10 my-2">
<button onclick="logout(); closeProfileDropdown()" class="w-full text-left px-4 py-2 text-sm text-red-400 hover:text-red-300 hover:bg-red-500/10 transition-colors">
<span class="material-symbols-outlined text-base mr-2">logout</span>
Logout
</button>
</div>
</div>
</div>
<button onclick="logout()" class="flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-300 hover:text-white hover:bg-white/10 rounded-lg transition-colors">
<span class="material-symbols-outlined text-base">logout</span>
Logout
</button>
</div>
</div>
<div class="hidden md:flex flex-1 items-center justify-center gap-9">
<a class="text-white text-sm font-medium leading-normal hover:text-primary transition-colors" href="#">Dashboard</a>
<a class="text-gray-400 text-sm font-medium leading-normal hover:text-primary transition-colors" href="#">Analytics</a>
<a class="text-gray-400 text-sm font-medium leading-normal hover:text-primary transition-colors" href="#">Settings</a>
</div>
<div class="flex flex-1 justify-end gap-3">
<button class="flex h-10 w-10 cursor-pointer items-center justify-center overflow-hidden rounded-lg bg-[#1C1C24] text-white transition-colors hover:bg-white/10">
<span class="material-symbols-outlined text-[#EAEAEB]">notifications</span>
</button>
<div id="userAvatar" onclick="openProfileModal()" class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 cursor-pointer hover:ring-2 hover:ring-primary transition-all" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuCZQ5VKNUekdFMuJBPmLhci7jOShPslwCqvwoUpVIY_8VsyxkUI_HlxR2fu3n1gtEbQhLcagvmuP9ad7qDOC7oQnS9PfnLlBmz-qISTVImL_lTrXmDVT0D1roQEQ5bvTMJQfr8rHf6OnAed_DkordHrJyJbGFfIMBkVvWrdnwrig03_8hxRlzvMjVSP9PXf3WPg9Fpqa-l71lywjDrb73iw2Mp9fBbjkSZGToyRUBXC8L4kA1QvzNYN6jEcA-H1kK9JBQGlTr7FKis");'></div>
</div>
</div>
</header>
<main class="w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-10 py-10">
<!-- PageHeading -->
<div class="flex flex-wrap justify-between gap-4 mb-8">
<div class="flex min-w-72 flex-col gap-2">
<p class="text-white text-4xl font-bold leading-tight tracking-tight">Welcome Back, Dr. Sharma</p>
<p class="text-[#8A8A93] text-base font-normal leading-normal">Here's a snapshot of your AI agent's performance and status.</p>
</div>
</div>
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
<!-- Left Column -->
<div class="lg:col-span-2 flex flex-col gap-6">
<!-- Public Link Section -->
<div class="flex flex-col gap-6 rounded-xl bg-[#1C1C24] p-6 border border-white/10">
<div class="flex flex-col gap-1">
<p class="text-white text-lg font-bold leading-tight tracking-[-0.015em]">Your Public AI Portfolio</p>
<p class="text-[#8A8A93] text-sm font-normal leading-normal">Share this link with clients, collaborators, and on your social profiles.</p>
</div>
<div class="flex flex-col sm:flex-row items-center gap-4 rounded-lg bg-background-dark p-3 border border-white/10">
<span class="text-primary mr-2 material-symbols-outlined">link</span>
<p class="text-[#EAEAEB] font-mono text-sm flex-grow">agent.io/anya-sharma</p>
<div class="flex items-center gap-2">
<button onclick="copyToClipboard()" class="flex items-center justify-center gap-2 h-9 px-3 bg-white/5 text-[#EAEAEB] text-sm font-medium rounded-md hover:bg-white/10 transition-colors">
<span class="material-symbols-outlined text-base">content_copy</span>
                                        Copy
                                    </button>
<button onclick="shareLink()" class="flex items-center justify-center gap-2 h-9 px-3 bg-white/5 text-[#EAEAEB] text-sm font-medium rounded-md hover:bg-white/10 transition-colors">
<span class="material-symbols-outlined text-base">share</span>
                                        Share
                                    </button>
</div>
</div>
<button class="w-full sm:w-auto flex items-center justify-center rounded-lg h-12 px-6 bg-primary text-white text-base font-bold leading-normal tracking-wide hover:bg-primary/90 transition-all self-start" onclick="window.location.href='chat.html'">
<span>Preview My AI Agent</span>
<span class="material-symbols-outlined ml-2">arrow_forward</span>
</button>
</div>

</div>
<!-- Right Column -->
<div class="flex flex-col gap-6">
<!-- Profile Strength -->
<div class="flex flex-col gap-4 rounded-xl bg-[#1C1C24] p-6 border border-white/10">
<div class="flex gap-6 justify-between items-center">
<p class="text-white text-base font-medium leading-normal">Profile Strength</p>
<p class="text-white text-2xl font-bold">85%</p>
</div>
<div class="rounded-full bg-[#3b4354] h-2"><div class="h-2 rounded-full bg-primary" style="width: 85%;"></div></div>
<p class="text-[#8A8A93] text-sm font-normal leading-normal">Add your recent publications to complete your profile.</p>
</div>
<!-- Connected Sources Card -->
<div class="flex flex-col gap-4 rounded-xl bg-[#1C1C24] p-6 border border-white/10">
<div class="flex flex-col gap-1 mb-2">
<p class="text-white text-lg font-bold leading-tight tracking-[-0.015em]">Connected Sources</p>
<p class="text-[#8A8A93] text-sm font-normal leading-normal">Keep your AI agent up-to-date with your latest work.</p>
</div>
<div class="flex flex-col gap-2">
<!-- List Item 1 -->
<div class="flex items-center gap-4 min-h-[64px] py-2 justify-between">
<div class="flex items-center gap-4">
<div class="text-[#EAEAEB] flex items-center justify-center rounded-lg bg-[#282e39] shrink-0 size-12">
<svg fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M12 20.94c1.5 0 2.75 1.06 4 1.06 3 0 6-8 6-12.22A4.91 4.91 0 0 0 17 5c-1.5 0-2.75 1.06-4 1.06-3 0-6-8-6-12.22A4.91 4.91 0 0 0 3 5c0 4.22 3 12.22 6 12.22 1.25 0 2.5-1.06 4-1.06Z"></path><path d="M12 6.85c1.5 0 2.75-1.06 4-1.06 3 0 6 8 6 12.22A4.91 4.91 0 0 1 17 21c-1.5 0-2.75-1.06-4-1.06-3 0-6-8-6-12.22A4.91 4.91 0 0 1 7 3c0-4.22 3-12.22 6-12.22 1.25 0 2.5 1.06 4 1.06Z"></path></svg>
</div>
<div class="flex flex-col justify-center">
<p class="text-white text-base font-medium leading-normal line-clamp-1">Behance</p>
<p class="text-[#8A8A93] text-sm font-normal leading-normal">Connected</p>
</div>
</div>
</div>
<!-- List Item 2 -->
<div class="flex items-center gap-4 min-h-[64px] py-2 justify-between">
<div class="flex items-center gap-4">
<div class="text-[#EAEAEB] flex items-center justify-center rounded-lg bg-[#282e39] shrink-0 size-12">
<svg fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path></svg>
</div>
<div class="flex flex-col justify-center">
<p class="text-white text-base font-medium leading-normal line-clamp-1">GitHub</p>
<p class="text-[#8A8A93] text-sm font-normal leading-normal">Connected</p>
</div>
</div>
</div>
</div>
<button class="mt-2 flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-white/10 text-white text-sm font-medium leading-normal hover:bg-white/20 transition-colors">
<span class="truncate">Manage Connections</span>
</button>
</div>
</div>
</div>
</main>
</div>
</div>

<!-- Profile Modal -->
<div id="profileModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center z-50">
<div id="modalContent" class="bg-[#1C1C24] rounded-xl border border-white/10 p-6 w-full max-w-md mx-4 relative cursor-move">
<div id="modalHeader" class="flex items-center justify-between mb-6 cursor-move">
<h2 class="text-white text-xl font-bold select-none">Profile Settings</h2>
<button onclick="closeProfileModal()" class="text-gray-400 hover:text-white cursor-pointer">
<span class="material-symbols-outlined">close</span>
</button>
</div>

<div class="space-y-6">
<!-- Profile Picture Section -->
<div class="flex flex-col items-center space-y-4">
<div id="avatarContainer" class="relative cursor-move" draggable="true">
<div id="modalAvatar" class="w-20 h-20 rounded-full bg-cover bg-center" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuCZQ5VKNUekdFMuJBPmLhci7jOShPslwCqvwoUpVIY_8VsyxkUI_HlxR2fu3n1gtEbQhLcagvmuP9ad7qDOC7oQnS9PfnLlBmz-qISTVImL_lTrXmDVT0D1roQEQ5bvTMJQfr8rHf6OnAed_DkordHrJyJbGFfIMBkVvWrdnwrig03_8hxRlzvMjVSP9PXf3WPg9Fpqa-l71lywjDrb73iw2Mp9fBbjkSZGToyRUBXC8L4kA1QvzNYN6jEcA-H1kK9JBQGlTr7FKis");'></div>
<button onclick="document.getElementById('fileInput').click()" class="absolute -bottom-1 -right-1 bg-primary text-white rounded-full p-1 hover:bg-primary/90">
<span class="material-symbols-outlined text-sm">edit</span>
</button>
</div>
<input type="file" id="fileInput" accept="image/*" class="hidden" onchange="handleFileUpload(event)">
<button onclick="document.getElementById('fileInput').click()" class="text-primary hover:text-primary/80 text-sm font-medium">
Change Profile Picture
</button>
</div>

<!-- Profile Form -->
<form id="profileForm" class="space-y-4">
<div id="nameContainer" class="cursor-move" draggable="true">
<label class="block text-white text-sm font-medium mb-2 select-none">Full Name</label>
<input type="text" id="profileName" class="w-full px-3 py-2 bg-[#282e39] border border-white/10 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-primary" placeholder="Enter your name">
</div>
<div>
<label class="block text-white text-sm font-medium mb-2">Email</label>
<input type="email" id="profileEmail" class="w-full px-3 py-2 bg-[#282e39] border border-white/10 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-primary" placeholder="Enter your email" readonly>
</div>
</form>

<!-- Modal Actions -->
<div class="flex gap-3 pt-4">
<button onclick="closeProfileModal()" class="flex-1 px-4 py-2 bg-white/10 text-white rounded-lg hover:bg-white/20 transition-colors">
Cancel
</button>
<button onclick="saveProfile()" class="flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">
Save Changes
</button>
</div>
</div>
</div>
</div>

<script>
// Check authentication on page load
function checkAuth() {
    const token = localStorage.getItem('authToken');
    if (!token) {
        window.location.href = '/login.html';
        return;
    }
    
    // Verify token is still valid
    fetch('/api/auth/verify', {
        method: 'GET',
        headers: {
            'Authorization': `Bearer ${token}`
        }
    })
    .then(response => {
        if (!response.ok) {
            localStorage.removeItem('authToken');
            localStorage.removeItem('userId');
            window.location.href = '/login.html';
        }
    })
    .catch(error => {
        console.error('Auth verification failed:', error);
        localStorage.removeItem('authToken');
        localStorage.removeItem('userId');
        window.location.href = '/login.html';
    });
}

// Copy to clipboard function
function copyToClipboard() {
    const link = 'agent.io/anya-sharma';
    navigator.clipboard.writeText(link).then(() => {
        // Show success feedback
        const button = event.target.closest('button');
        const originalText = button.innerHTML;
        button.innerHTML = '<span class="material-symbols-outlined text-base">check</span> Copied!';
        button.classList.add('bg-green-600');
        
        setTimeout(() => {
            button.innerHTML = originalText;
            button.classList.remove('bg-green-600');
        }, 2000);
    }).catch(err => {
        console.error('Failed to copy: ', err);
        alert('Failed to copy link');
    });
}

// Share function
function shareLink() {
    const link = 'https://agent.io/anya-sharma';
    const title = 'Check out my AI Portfolio Agent';
    const text = 'Chat with my AI assistant to learn about my projects and experience!';
    
    if (navigator.share) {
        navigator.share({
            title: title,
            text: text,
            url: link
        }).catch(err => console.log('Error sharing:', err));
    } else {
        // Fallback for browsers that don't support Web Share API
        const shareText = `${title} - ${text} ${link}`;
        navigator.clipboard.writeText(shareText).then(() => {
            alert('Share text copied to clipboard!');
        }).catch(err => {
            console.error('Failed to copy share text: ', err);
            alert('Share link: ' + link);
        });
    }
}

// Logout function
function logout() {
    localStorage.removeItem('authToken');
    localStorage.removeItem('userId');
    window.location.href = 'login.html';
}

// Load user data on page load
function loadUserData() {
    const token = localStorage.getItem('authToken');
    if (!token) return;
    
    // Fetch user profile
    fetch('/api/user/profile', {
        headers: {
            'Authorization': `Bearer ${token}`
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.name) {
            // Update welcome message with actual user name
            const welcomeText = document.querySelector('.text-4xl');
            if (welcomeText) {
                welcomeText.textContent = `Welcome Back, ${data.name}`;
            }
        }
    })
    .catch(error => console.error('Error loading user data:', error));
    
    // Fetch connected platforms
    fetch('/api/portfolio/connections', {
        headers: {
            'Authorization': `Bearer ${token}`
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.connections) {
            updateConnectedSources(data.connections);
        }
    })
    .catch(error => console.error('Error loading connections:', error));
}

// Update connected sources display
function updateConnectedSources(connections) {
    // This would update the connected sources section with actual data
    console.log('Connected platforms:', connections);
}

// Profile dropdown functions
function toggleProfileDropdown() {
    const dropdown = document.getElementById('profileDropdown');
    const arrow = document.getElementById('profileArrow');
    
    if (dropdown.classList.contains('hidden')) {
        dropdown.classList.remove('hidden');
        arrow.style.transform = 'rotate(180deg)';
    } else {
        dropdown.classList.add('hidden');
        arrow.style.transform = 'rotate(0deg)';
    }
}

function closeProfileDropdown() {
    const dropdown = document.getElementById('profileDropdown');
    const arrow = document.getElementById('profileArrow');
    dropdown.classList.add('hidden');
    arrow.style.transform = 'rotate(0deg)';
}

function viewProfile() {
    alert('View Profile functionality - redirect to public profile page');
}

// Close dropdown when clicking outside
document.addEventListener('click', function(event) {
    const dropdown = document.getElementById('profileDropdown');
    const button = event.target.closest('button');
    
    if (!button || !button.onclick || button.onclick.toString().indexOf('toggleProfileDropdown') === -1) {
        if (dropdown && !dropdown.classList.contains('hidden')) {
            closeProfileDropdown();
        }
    }
});

// Profile modal functions
function openProfileModal() {
    const modal = document.getElementById('profileModal');
    modal.classList.remove('hidden');
    modal.classList.add('flex');
    loadProfileData();
    initDragModal();
    initDragElements();
}

// Make profile elements draggable
function initDragElements() {
    const avatarContainer = document.getElementById('avatarContainer');
    const nameContainer = document.getElementById('nameContainer');
    
    makeDraggable(avatarContainer);
    makeDraggable(nameContainer);
}

function makeDraggable(element) {
    let isDragging = false;
    let currentX, currentY, initialX, initialY;
    let xOffset = 0, yOffset = 0;
    
    element.addEventListener('mousedown', dragStart);
    document.addEventListener('mousemove', drag);
    document.addEventListener('mouseup', dragEnd);
    
    function dragStart(e) {
        if (e.target.tagName === 'INPUT') return; // Don't drag when clicking input
        
        initialX = e.clientX - xOffset;
        initialY = e.clientY - yOffset;
        
        if (e.target === element || element.contains(e.target)) {
            isDragging = true;
            element.style.position = 'relative';
            element.style.zIndex = '1000';
        }
    }
    
    function drag(e) {
        if (isDragging) {
            e.preventDefault();
            currentX = e.clientX - initialX;
            currentY = e.clientY - initialY;
            xOffset = currentX;
            yOffset = currentY;
            
            element.style.transform = `translate(${currentX}px, ${currentY}px)`;
        }
    }
    
    function dragEnd() {
        initialX = currentX;
        initialY = currentY;
        isDragging = false;
        element.style.zIndex = 'auto';
    }
}

// Make modal draggable
function initDragModal() {
    const modal = document.getElementById('modalContent');
    const header = document.getElementById('modalHeader');
    let isDragging = false;
    let currentX;
    let currentY;
    let initialX;
    let initialY;
    let xOffset = 0;
    let yOffset = 0;
    
    header.addEventListener('mousedown', dragStart);
    document.addEventListener('mousemove', drag);
    document.addEventListener('mouseup', dragEnd);
    
    function dragStart(e) {
        initialX = e.clientX - xOffset;
        initialY = e.clientY - yOffset;
        
        if (e.target === header || header.contains(e.target)) {
            isDragging = true;
            modal.style.position = 'fixed';
            modal.style.margin = '0';
        }
    }
    
    function drag(e) {
        if (isDragging) {
            e.preventDefault();
            currentX = e.clientX - initialX;
            currentY = e.clientY - initialY;
            xOffset = currentX;
            yOffset = currentY;
            
            modal.style.transform = `translate(${currentX}px, ${currentY}px)`;
        }
    }
    
    function dragEnd() {
        initialX = currentX;
        initialY = currentY;
        isDragging = false;
    }
}

function closeProfileModal() {
    const modal = document.getElementById('profileModal');
    const modalContent = document.getElementById('modalContent');
    const avatarContainer = document.getElementById('avatarContainer');
    const nameContainer = document.getElementById('nameContainer');
    
    modal.classList.add('hidden');
    modal.classList.remove('flex');
    
    // Reset modal position
    modalContent.style.transform = 'translate(0px, 0px)';
    modalContent.style.position = 'relative';
    modalContent.style.margin = '0 auto';
    
    // Reset draggable elements
    if (avatarContainer) {
        avatarContainer.style.transform = 'translate(0px, 0px)';
        avatarContainer.style.position = 'relative';
    }
    if (nameContainer) {
        nameContainer.style.transform = 'translate(0px, 0px)';
        nameContainer.style.position = 'relative';
    }
}

function loadProfileData() {
    const token = localStorage.getItem('authToken');
    if (!token) return;
    
    fetch('/api/user/profile', {
        headers: {
            'Authorization': `Bearer ${token}`
        }
    })
    .then(response => response.json())
    .then(data => {
        document.getElementById('profileName').value = data.name || '';
        document.getElementById('profileEmail').value = data.email || '';
        if (data.profile_picture) {
            updateProfilePicture(data.profile_picture);
        }
    })
    .catch(error => console.error('Error loading profile:', error));
}

function handleFileUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    // Validate file type
    if (!file.type.startsWith('image/')) {
        alert('Please select an image file');
        return;
    }
    
    // Validate file size (max 5MB)
    if (file.size > 5 * 1024 * 1024) {
        alert('File size must be less than 5MB');
        return;
    }
    
    // Create preview
    const reader = new FileReader();
    reader.onload = function(e) {
        updateProfilePicture(e.target.result);
    };
    reader.readAsDataURL(file);
}

function updateProfilePicture(imageUrl) {
    document.getElementById('modalAvatar').style.backgroundImage = `url(${imageUrl})`;
    document.getElementById('userAvatar').style.backgroundImage = `url(${imageUrl})`;
}

function saveProfile() {
    const token = localStorage.getItem('authToken');
    if (!token) return;
    
    const name = document.getElementById('profileName').value.trim();
    if (!name) {
        alert('Name is required');
        return;
    }
    
    fetch('/api/user/profile', {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({ name })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success || data.message) {
            alert('Profile updated successfully!');
            closeProfileModal();
            loadUserData();
        } else {
            alert(data.error || 'Failed to update profile');
        }
    })
    .catch(error => {
        console.error('Error saving profile:', error);
        alert('Network error. Please try again.');
    });
}

// Run auth check and load data when page loads
checkAuth();
loadUserData();
</script>
</body></html>